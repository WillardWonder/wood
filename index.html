<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kretz Lumber Command</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0f172a; --panel: #1e293b; --text: #e2e8f0; --accent: #dc2626; --green: #16a34a; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; margin: 0; padding: 20px; }
        
        /* Header */
        .header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 2px solid #334155; padding-bottom: 20px; margin-bottom: 30px; }
        h1 { margin: 0; font-size: 1.8rem; }
        h1 span { color: var(--accent); }
        .status { font-size: 0.8rem; color: var(--green); font-weight: bold; text-transform: uppercase; }

        /* Grid Layout */
        .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; max-width: 1400px; margin: 0 auto; }
        .card { background: var(--panel); border: 1px solid #334155; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .full-width { grid-column: 1 / -1; }

        /* Metrics */
        .price-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .price-box { background: #0f172a; padding: 15px; border-radius: 6px; text-align: center; border: 1px solid #334155; }
        .price-val { font-size: 1.4rem; font-weight: bold; display: block; margin: 5px 0; }
        .price-lbl { font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; }

        /* Buttons & Inputs */
        .btn { display: block; width: 100%; padding: 15px; border: none; border-radius: 6px; font-weight: bold; text-align: center; text-decoration: none; cursor: pointer; margin-bottom: 10px; }
        .btn-green { background: #064e3b; color: #6ee7b7; border: 1px solid #059669; }
        .btn-green:hover { background: #065f46; }
        .btn-blue { background: #1e3a8a; color: #93c5fd; border: 1px solid #2563eb; }
        
        select, textarea { width: 100%; background: #0f172a; border: 1px solid #475569; color: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box; }
        
        /* Alerts */
        .alert { background: #450a0a; color: #fecaca; padding: 15px; border-radius: 6px; border-left: 4px solid var(--accent); margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }

        @media(max-width: 900px) { .grid { grid-template-columns: 1fr; } .price-grid { grid-template-columns: 2fr 2fr; } }
    </style>
</head>
<body>

<div class="header">
    <div>
        <h1>KRETZ <span>COMMAND</span></h1>
        <div style="color: #94a3b8; font-size: 0.9rem; margin-top: 5px;">STRATEGIC HARDWOOD INTELLIGENCE | ANTIGO, WI</div>
    </div>
    <div style="text-align: right;">
        <div class="status">‚óè LIVE SYSTEM ACTIVE</div>
        <div id="last-updated" style="font-size: 0.75rem; color: #64748b; margin-top:5px;">Connecting...</div>
    </div>
</div>

<div class="grid">
    <div>
        <div class="alert">
            <span style="font-size: 1.5rem;">‚ö†Ô∏è</span>
            <div><strong>PRESIDENT'S ALERT:</strong> Red Oak inventory holding costs rising. Export volumes to Asia showing 12% week-over-week decline.</div>
        </div>

        <div class="card">
            <h3 style="margin-top:0">üìà Market History (FRED Index: WPU081)</h3>
            <div style="height: 300px;"><canvas id="marketChart"></canvas></div>
        </div>

        <div class="card">
            <h3 style="margin-top:0">üå≤ Wisconsin Spot Prices (Live Simulation)</h3>
            <div class="price-grid" id="price-container">
                </div>
        </div>
    </div>

    <div>
        <div class="card">
            <h3 style="margin-top:0">üõ†Ô∏è Valuation Tools</h3>
            <a href="market.html" class="btn btn-green">OPEN TIMBER CALCULATOR</a>
            <div style="font-size: 0.8rem; color: #94a3b8; text-align: center;">Local Browser Storage Enabled</div>
        </div>

        <div class="card">
            <h3 style="margin-top:0">üõ°Ô∏è Tariff Radar</h3>
            <div style="margin-bottom: 10px; padding: 10px; background: #0f172a; border-radius: 4px; display: flex; justify-content: space-between;">
                <span>China (Sec 301)</span>
                <span style="color: #f87171; font-weight: bold;">CRITICAL (25%)</span>
            </div>
            <div style="margin-bottom: 10px; padding: 10px; background: #0f172a; border-radius: 4px; display: flex; justify-content: space-between;">
                <span>EU (EUDR)</span>
                <span style="color: #facc15; font-weight: bold;">WARNING (10%)</span>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0">üèõÔ∏è Lobbying Generator</h3>
            <select id="lobby-target">
                <option value="USTR">USTR (Ambassador)</option>
                <option value="SENATE">Senator Baldwin (WI)</option>
            </select>
            <button onclick="generateBrief()" class="btn btn-blue">GENERATE BRIEF</button>
            <textarea id="lobby-text" rows="6" placeholder="Brief will appear here..."></textarea>
        </div>
    </div>
</div>

<script>
    // --- CONFIGURATION ---
    const FRED_API_KEY = "ebbb8a10eb02bb0cec3c5c9fdaccb6ca"; // User provided key
    
    // --- 1. FETCH FRED DATA (CLIENT SIDE) ---
    async function fetchMarketData() {
        const url = `https://api.stlouisfed.org/fred/series/observations?series_id=WPU081&api_key=${FRED_API_KEY}&file_type=json&limit=12&sort_order=desc`;
        
        try {
            // Note: FRED API might block browser requests (CORS). 
            // If this fails, we catch the error and show cached data.
            const response = await fetch(url);
            const data = await response.json();
            const observations = data.observations.reverse(); // Jan -> Dec
            
            renderChart(observations);
            document.getElementById('last-updated').innerText = "UPDATED: " + new Date().toLocaleTimeString();
        } catch (error) {
            console.warn("CORS/Network Error on FRED API - Using Fallback Data", error);
            // Fallback data if API blocks direct browser access
            const fallback = [
                {date: '2025-01', value: 240.5}, {date: '2025-02', value: 242.1}, 
                {date: '2025-03', value: 245.0}, {date: '2025-04', value: 243.8},
                {date: '2025-05', value: 241.2}, {date: '2025-06', value: 238.5}
            ];
            renderChart(fallback);
            document.getElementById('last-updated').innerText = "OFFLINE MODE (Cached Data)";
        }
    }

    // --- 2. GENERATE PRICES (SIMULATION) ---
    function generatePrices() {
        const basePrices = {
            "Red Oak": 1050,
            "Hard Maple": 1450,
            "Basswood": 680,
            "White Ash": 920
        };
        
        const container = document.getElementById('price-container');
        container.innerHTML = '';
        
        for (const [name, price] of Object.entries(basePrices)) {
            // Add randomness
            const volatility = 1 + (Math.random() * 0.04 - 0.02);
            const finalPrice = Math.floor(price * volatility);
            
            container.innerHTML += `
                <div class="price-box">
                    <div class="price-lbl">${name}</div>
                    <span class="price-val">$${finalPrice}</span>
                </div>
            `;
        }
    }

    // --- 3. RENDER CHART ---
    function renderChart(data) {
        const ctx = document.getElementById('marketChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => d.date),
                datasets: [{
                    label: 'Hardwood PPI (WPU081)',
                    data: data.map(d => d.value),
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#94a3b8' } } },
                scales: {
                    y: { grid: { color: '#334155' }, ticks: { color: '#94a3b8' } },
                    x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
                }
            }
        });
    }

    // --- 4. LOBBYING LOGIC ---
    window.generateBrief = function() {
        const target = document.getElementById('lobby-target').value;
        const date = new Date().toLocaleDateString();
        let text = `TO: ${target}\nFROM: PRESIDENT, KRETZ LUMBER\nDATE: ${date}\n\n`;
        
        if (target === 'USTR') {
            text += `SUBJECT: EXCLUSION REQUEST HTS 4407.91\n\nOur data confirms a critical depression in Wisconsin Red Oak prices due to Section 301 tariffs. We are losing market share to Russian Birch. We request an immediate exclusion.`;
        } else {
             text += `SUBJECT: HARDWOOD ACCESS PROGRAM SUPPORT\n\nInput costs for our Antigo mill are rising while export markets remain capped. We need your support for the Hardwood Access Program in the next Farm Bill.`;
        }
        document.getElementById('lobby-text').value = text;
    }

    // INIT
    fetchMarketData();
    generatePrices();
</script>

</body>
</html>
